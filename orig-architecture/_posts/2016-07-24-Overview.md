---
layout: post
title:  "2. Overview"
date:   2016-07-27 12:13:03 +0100
categories: jekyll update
---
Overview
========

Architecture Overview
---------------------

![](/img/worldpayWithinFig1.png){width="5.509027777777778in" height="2.0in"}In the
IoT, each Thing will perform the function it is designed for be it
acting as a sensor, or a controller or both. In order for Thing to be
able to make and receive payments for services they can provide to other
Things, they need to add the payments functionality contained in
Worldpay Within.

![](media/image3.emf){width="6.196527777777778in"
height="3.1909722222222223in"}Things in the IoT will be implemented on
dedicated low cost processor systems. The Thing and Worldpay Within must
co-exist and operate on the resources provided by these devices, as
demonstrated in Figure 2.

In order to make and receive payments in the IoT, a Thing must be able
to perform the roles of “consumer”, to make a payment for services, and
the “merchant”, to receive a payment for provision of services. In the
Worldpay Within IoT architecture, the “consumer” pays for services by
supporting Host Card Emulation (HCE). The “merchant” receives payments
for services by supporting Host Terminal Emulation (HTE). Worldpay
Within contains both an HCE Brain & HTE Brain functionalities, ensuring
a Thing can both consume and supply services. These services are
provided through a series of public APIs, described within this
document.

HCE and HTE require the secure storage and use of the credentials during
the payments process. This necessitates the use of secure processing
within the Thing in a “Secure Execution Environment”.

For HCE Things, these credentials include the details of the “card”
which the payment will be made from. For HTE Things, these credentials
include the details the Merchant requires to perform transactions in
Online.worldpay.com.

As well as the provision of the payment for the services, Worldpay
Within provides for the generation and validation of secure service
tokens, which allow for services to be consumed in part or together, but
separately from the payments functionality.

Secure Messaging
----------------

Online.worldpay.com provides a secure payments interface with devices
connecting to Online.worldpay.com using Transport Layer Security (TLS).
The payment process involves the sending of payment credentials to
Online.worldpay.com from the IoT Thing. In order to ensure the
credentials are not exposed, the IoT Thing must ensure that these
credentials are only available within a Secure Execution Environment
(SEE) within the Thing, and that they are protected at all points
between the SEE and Online.worldpay.com. There are several architecture
considerations ![](media/image4.emf){width="6.670138888888889in"
height="6.083333333333333in"}to achieving this security, as shown in
Figure 2, dependent on the platform chosen for the IoT Thing.

Ideally the TLS connection would be secured from within the SEE, however
this may not be possible due to the hardware constraints. In this case,
the implementation of TLS within the Thing should be split to ensure
that the data encryption services are performed from within the SEE. If
this is not possible, then a P2PE service layer may be required to
secure the data from the SEE to Online.worldpay.com.

### <span id="_Ref438730041" class="anchor"><span id="_Toc451429412" class="anchor"></span></span>Credential provisioning

When each IoT Brain is personalised with its Online.worldpay.com payment
credentials, the card details should be Tokenised and channel restricted
to Online.worldpay.com.

### Implementation

Devices used in the IoT are lower end processors with limited processing
power and memory. In order to minimise the impact on the device,
implementations of Worldpay Within for IoT devices will be programmed in
C or C\# language.

The messaging shall be based on Java Script Object Notation (JSON)[^2]
rather than the more common (e.g. EMV) Application Protocol Data Units
(APDU) as the project will already need to use JSON to communicate with
Online.worldpay.com REST-full[^3] back end. There are a number of
implementations of JSON available in C or C\# suitable for the proposed
IoT platforms.